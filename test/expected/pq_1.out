CREATE TABLE t (id integer primary key, val real[]);
select setseed(0.5);
 setseed 
---------
 
(1 row)

INSERT INTO t select id, array[random(), random(), random(), random()] from generate_series(1,10000) id;
CREATE INDEX hnsw_pq_idx ON t USING hnsw (val) WITH (dims=4, m=8, efConstruction=16, efSearch=10, pqBits=3, pqSubqs=2);
CREATE INDEX ON t USING hnsw (val) WITH (dims=4, m=8, efConstruction=16, efSearch=10);
SET enable_seqscan = off;
explain SELECT * FROM t ORDER BY val <-> array[0.5,0.5,0.5,0.5] limit 10;
                                   QUERY PLAN                                    
---------------------------------------------------------------------------------
 Limit  (cost=40.00..40.07 rows=10 width=40)
   ->  Index Scan using t_val_idx on t  (cost=40.00..105.10 rows=10000 width=40)
         Order By: (val <-> '{0.5,0.5,0.5,0.5}'::real[])
(3 rows)

SELECT * FROM t ORDER BY val <-> array[0.5,0.5,0.5,0.5] limit 10;
  id  |                      val                      
------+-----------------------------------------------
  170 | {0.4819531,0.5066943,0.49743116,0.5620343}
 2521 | {0.50923246,0.42129982,0.54364836,0.47519395}
 1926 | {0.46754876,0.46043652,0.52793247,0.5737315}
 6319 | {0.49389404,0.4781814,0.570063,0.42717883}
 9546 | {0.52608037,0.43451795,0.5082416,0.42250523}
 1767 | {0.536596,0.411598,0.5288314,0.53256726}
 4179 | {0.49095112,0.5693811,0.57199687,0.53341657}
 4467 | {0.5068394,0.5771756,0.5732788,0.5240346}
 7938 | {0.57250184,0.5124374,0.44524005,0.56254816}
 8701 | {0.5648914,0.4820384,0.44251937,0.42523447}
(10 rows)

SET enable_seqscan = on;
SET enable_indexscan = off;
explain SELECT * FROM t ORDER BY val <-> array[0.5,0.5,0.5,0.5] limit 10;
                             QUERY PLAN                             
--------------------------------------------------------------------
 Limit  (cost=435.10..435.12 rows=10 width=40)
   ->  Sort  (cost=435.10..460.10 rows=10000 width=40)
         Sort Key: ((val <-> '{0.5,0.5,0.5,0.5}'::real[]))
         ->  Seq Scan on t  (cost=0.00..219.00 rows=10000 width=40)
(4 rows)

SELECT * FROM t ORDER BY val <-> array[0.5,0.5,0.5,0.5] limit 10;
  id  |                      val                      
------+-----------------------------------------------
  170 | {0.4819531,0.5066943,0.49743116,0.5620343}
 2521 | {0.50923246,0.42129982,0.54364836,0.47519395}
 1926 | {0.46754876,0.46043652,0.52793247,0.5737315}
 6319 | {0.49389404,0.4781814,0.570063,0.42717883}
 9546 | {0.52608037,0.43451795,0.5082416,0.42250523}
 1767 | {0.536596,0.411598,0.5288314,0.53256726}
 4179 | {0.49095112,0.5693811,0.57199687,0.53341657}
 4467 | {0.5068394,0.5771756,0.5732788,0.5240346}
 7938 | {0.57250184,0.5124374,0.44524005,0.56254816}
 8701 | {0.5648914,0.4820384,0.44251937,0.42523447}
(10 rows)

select pg_relation_size('hnsw_pq_idx');
 pg_relation_size 
------------------
           540672
(1 row)

drop index hnsw_pq_idx;
CREATE INDEX hnsw_idx ON t USING hnsw (val) WITH (dims=4, m=8, efConstruction=16, efSearch=10);
SELECT * FROM t ORDER BY val <-> array[0.5,0.5,0.5,0.5] limit 10;
  id  |                      val                      
------+-----------------------------------------------
  170 | {0.4819531,0.5066943,0.49743116,0.5620343}
 2521 | {0.50923246,0.42129982,0.54364836,0.47519395}
 1926 | {0.46754876,0.46043652,0.52793247,0.5737315}
 6319 | {0.49389404,0.4781814,0.570063,0.42717883}
 9546 | {0.52608037,0.43451795,0.5082416,0.42250523}
 1767 | {0.536596,0.411598,0.5288314,0.53256726}
 4179 | {0.49095112,0.5693811,0.57199687,0.53341657}
 4467 | {0.5068394,0.5771756,0.5732788,0.5240346}
 7938 | {0.57250184,0.5124374,0.44524005,0.56254816}
 8701 | {0.5648914,0.4820384,0.44251937,0.42523447}
(10 rows)

select pg_relation_size('hnsw_idx');
 pg_relation_size 
------------------
           688128
(1 row)

DROP TABLE t;
